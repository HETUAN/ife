<!DOCTYPE>
<html>

<head>
    <meta charset="utf-8">
    <title>IFE JavaScript Task 25</title>
    <style type="text/css">
        .menu {
            width: 200px;
        }
        
        div {
            border: 1px solid red;
        }
    </style>
    <script type="text/javascript">
        var tree = function(id) {
        var root = document.getElementById(id);
        if (root == null)
            return null;

        var curDeep = 0;
        var curElement = root;
        // 获取节点的深度
        var getDeep = function(ele) {
            var d = 0;
            if (ele == root)
                return d;

            while (ele != root) {
                d++;
                ele = ele.parentElemant;
            }
            return d;
        }
        var Load = function(dataSource) {

        };

        var addElement = function(name, check) {
            var taga = null;
            var tagcheck = null;
            var tagspan = null;
            var e = document.createElementNS('<div show="y"><a></a><input type="checkbox" ' + check == true ? "checked" : "" + ' /><span>' + name + '</span></div>');
            curElement.childElement.push(e);
            e.onclick = function() {
                if (this.attr("show") != "y") {
                    this.style.display = "block";
                    this.attr("show") = "y"
                } else {
                    this.style.display = "none";
                    this.attr("show") = "n"
                }
            }
            if (curElement.childElement.length > 0) {
                curElement.childElement[0].innerText = "-";
            }
        }
        return this;
    }


/*New Function*/
    var curElement = document.getElementById("leftmenu");
    var addElement = function(name, check) {
        //var curElement = document.getElementById("leftmenu");
        var div = document.createElement('div');
        var a = document.createElement('a');
        var input = document.createElement('input');
        var span = document.createElement('span');
        a.innerHTML = "&nbsp;";
        input.setAttribute("type", "checkbox");
        if (check)
            input.setAttribute("checked", "checked");
        span.innerText = name;
        div.style.marginLeft = (GetDeepth(curElement))*20+"px";
        div.appendChild(a);
        div.appendChild(input);
        div.appendChild(span);
        curElement.appendChild(div);
        //console.log(curElement.children);
        div.onclick = function() {
            ClearBgColor();
            this.style.backgroundColor = "blue";
            curElement = this;
            console.log(curElement);
        }
        div.doubleclick = function() {
            if (this.attr("show") != "y") {
                this.style.display = "block";
                this.attr("show") = "y"
            } else {
                this.style.display = "none";
                this.attr("show") = "n"
            }
        }
        if (curElement.children.length > 0) {}
    }

    function ClearBgColor() {
        var tags = document.getElementById("leftmenu").getElementsByTagName("div");
        //console.log(tags);
        var len = tags.length;
        for(var idx =0 ;idx<len;idx++) {
                tags[idx].style.backgroundColor = "#FFFFFF";
            }
        }
    
    
    function GetDeepth(ele){
        //
        var root = document.getElementById("leftmenu");
        var body = document.getElementsByTagName("body")[0];
        if(root==ele)
            return 0;
            
        var deep = 1;
        var e = ele;
        while(true)
        {
            if(e==root)
                break;
            if(e==body)
                return -1;
            e = e.parentElement;
            deep++;
        }
        
        return deep;
    }
    
    
    window.onload = function() { 
        curElement = document.getElementById("leftmenu"); 
        addElement("ASD", true);
        addElement("QWE", false);
        addElement("ZXC", false);
        addElement("!@#", true);
        document.getElementById("addBtn").onclick = function() {
            //
            var name = document.getElementById("addText").value;
            document.getElementById("addText").value = "";
            document.getElementById("addText").focus();
            addElement(name, false);
        }
    }
    </script>
</head>

<body>
    <div id="leftmenu" class="menu">
        <!--
        <div>
            <a>-</a>
            <input type="checkbox" checked="checked" />
            <span>1</span>
            <div>
                <a>&nbsp;</a><input type="checkbox" /><span>1-1</span></div>
            <div>
                <a>&nbsp;</a><input type="checkbox" /><span>1-2</span></div>
            <div>
                <a>&nbsp;</a><input type="checkbox" /><span>1-3</span></div>
        </div>
        <div>
            <a>-</a>
            <input type="checkbox" />
            <span>2</span>
            <div>
                <a>&nbsp;</a><input type="checkbox" /><span>2-1</span></div>
            <div>
                <a>&nbsp;</a><input type="checkbox" /><span>2-2</span></div>
        </div>
        <div>
            <a>+</a>
            <input type="checkbox" />
            <span>3</span>
        </div>
        -->
    </div>
    <input type="text" id="searchText" value="" />
    <input type="button" id="searchBtn" value="Search" />
    <input type="text" id="addText" value="" />
    <input type="button" id="addBtn" value="Add" />
</body>

</html>